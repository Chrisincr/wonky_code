<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="./style.css">
    <title>PacMan</title>
  </head>
  <body onload="renderWorld(10,30)">
    <div id="w-cont">
      <div id="world"></div>
    </div>
    <script type="text/javascript">
      // var raw = [
      //   [1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,3],
      //   [5,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,5],
      //   [5,9,1,6,6,3,9,1,6,6,6,6,6,6,3,9,8,6,6,6,6,6,6,7,0,1,3,9,8,6,7,9,8,7,9,5],
      //   [5,9,2,6,6,4,9,5,0,0,0,0,0,0,5,9,0,0,0,0,0,0,0,0,0,5,5,9,9,9,9,9,9,9,9,5],
      //   [5,9,9,9,9,9,9,5,0,1,6,6,6,6,4,0,1,0,0,0,0,0,0,3,0,5,5,9,1,6,6,6,6,3,9,5],
      //   [2,6,6,6,6,3,9,5,0,5,9,9,9,9,9,0,5,0,0,0,0,0,0,5,0,5,5,9,5,0,0,0,0,5,9,5],
      //   [0,0,0,0,0,5,9,5,0,5,9,1,6,6,3,0,5,0,0,0,0,0,0,5,0,5,5,9,2,6,6,6,6,4,9,5],
      //   [8,6,6,6,6,4,9,5,0,5,9,5,0,0,5,0,2,6,6,6,6,6,6,4,0,5,5,9,9,9,9,9,9,9,9,5],
      //   [0,0,0,0,0,0,9,5,0,5,9,2,6,3,5,0,0,0,0,0,0,0,0,0,0,5,5,9,1,6,6,6,6,3,9,5],
      //   [8,6,6,6,6,3,9,5,0,5,9,9,9,5,5,9,8,6,6,6,6,6,6,7,9,5,5,9,5,0,0,0,0,5,9,5],
      //   [0,0,0,0,0,5,9,5,0,2,6,6,6,4,5,9,9,9,9,9,9,9,9,9,9,5,5,9,5,0,0,0,0,5,9,5],
      //   [1,6,6,6,6,4,9,2,6,6,6,6,6,6,4,9,8,6,6,7,9,1,3,9,1,4,5,9,2,6,6,6,6,4,9,5],
      //   [5,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,5,5,9,5,0,5,9,9,9,9,9,9,9,9,5],
      //   [5,9,8,6,6,6,7,9,8,6,6,6,6,6,6,6,6,6,6,7,9,5,5,9,2,6,4,9,8,6,6,6,6,7,9,5],
      //   [5,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,5,5,42,9,9,9,9,9,9,9,9,9,9,9,5],
      //   [2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,4]
      // ]
      var render_space = document.getElementById('world');

      function oneOr(num) {
        return Math.floor(Math.random() * num);
      }
      function slightchance(num) {
        return Math.floor(Math.random() * (Math.random() * num));
      }

      function world_gen(w, h){
        w *= 4;
        // 1 Column = 4 Units
        var op = [];
        var prevnum = false;
        //Top
        op.push([1]);
        for (var i = 0; i < w-2; i++) {op[0].push(6);}
        op[0].push(3);

        // Column 1
        for(var f = 1; f <= h-1; f++){
          var rand1 = slightchance(2);
          if((rand1 == 1 && !prevnum) && ((h - f) > 10 ) && (f > 3)){
            op.push([5,9,2,6]);
            op.push([5,9,9,9]);
            op.push([2,6,3,9]);
            op.push([0,0,5,9]);
            op.push([0,0,5,9]);
            op.push([0,0,5,9]);
            op.push([1,6,4,9]);
            op.push([5,9,9,9]);
            op.push([5,9,1,6]);
            prevnum = true;
            f+=8;
          }
          else if (((h - f) > 3) && (f > 3)){
            switch (slightchance(2)) {
              case 1:
                op.push([5,9,5,0]);
                op.push([5,9,2,6]);
                op.push([5,9,9,9]);
                op.push([5,9,1,6]);
                op.push([5,9,5,0]);
                f+=4;
                break;
              default:
                op.push([5,9,5,0]);
            }
          }
          else{
            op.push([5,11,11,11]);
          }
        }

        //Second Column
        if (w>1) {
          for (var f = 1; f <= h-1; f++) {
            if((op[f][3] == 6) &&
            (op[f-4][7] == undefined) &&
            (op[f-3][7] == undefined) &&
            (op[f-2][7] == undefined) &&
            (op[f-2][2] != 4)){
              op[f].push(6,4,9,2);
              op[f-1].push(6,3,9,5);
              op[f-1][3] = 2;
              op[f-2][3] = 5;
              op[f-3][3] = 5;
              op[f-3][3] = 1;
              op[f-3].push(6,6,6,3)
              op[f-2].push(42,9,9,5)
            }
            else if ((op[f][3] == 6)) {
              op[f].push(6,6,6,6);
            }
            else if(op[f][3] ==11){
              op[f].push(12,12,12,12);
            }
            else if((op[f][3] == 9) && (op[f+1][3] != 9) && (op[f-1][2] != 4)){
              op[f].push(9,9,9,9);
            }
          }
        }


        //Bottom
        var opb = [];
        opb.push(2);
        for (var i = 0; i < w-2; i++) {opb.push(6);}
        opb.push(4);
        op[h] = opb;

        //End
        return op;

      }

      function renderWorld(w,h){
        var raw = world_gen(w,h);
        var op = '';
        for(i in raw){
          op += '<div class="row">';
          for(j in raw[i]){
            switch(raw[i][j]){
              case 0:
                op += '<div class="piece empty"></div>';
                break;
              case 1:
                op += '<div class="piece up-left"></div>';
                break;
              case 2:
                op += '<div class="piece b-left"></div>';
                break;
              case 3:
                op += '<div class="piece up-right"></div>';
                break;
              case 4:
                op += '<div class="piece b-right"></div>';
                break;
              case 5:
                op += '<div class="piece vert"></div>';
                break;
              case 6:
                op += '<div class="piece horz"></div>';
                break;
              case 7:
                op += '<div class="piece close-l"></div>';
                break;
              case 8:
                op += '<div class="piece close-r"></div>';
                break;
              case 9:
                op += '<div class="piece coin-c"><div class="coin"></div></div>';
                break;
              case 10:
                op+= '<div class="piece empty" id="pac"></div>'
                break;
              case 42:
                op += '<div class="piece powerup-c"><div class="powerup"></div></div>'
                break;
              default:
                op += '<div class="piece error"></div>';
                break;
            }
          }
          op += '</div>'
        }
        console.log(op);
        render_space.innerHTML = op;
      }
    </script>
  </body>
</html>
